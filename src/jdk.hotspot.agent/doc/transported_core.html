<html>
<head>
<title>
Debugging transported core dumps
</title>
</head>
<body>
<h1>Debugging transported core dumps</h1>

<p>
When a core dump is moved to a machine different from the one where it was
produced ("transported core dump"), debuggers (dbx, gdb, windbg or SA) do not
always successfully open the core dump. This is due to  library (shared
objects or DLLs) mismatches between the core dump machine and the debugger machine.
For this reason you should first consider using one of the following approaches to
debugging the core dump rather than transporting it to a different machine:
<ul>
  <li>Remote login to the machine that the core dump was produced on,
    and use <a href="clhsdb.html">CLHSDB - SA command line HSDB interface</a>.
  <li>Use SA remote debugging support to remotely debug the core directly on the machine
   it was produced on. This is done by first running <b>jhsdb debugd</b> on the machine with the core dump,
    and then attaching to it from another machine by using the jhsdb <b>--connect</b> argument. See
    the <b>jhsdb</b> man page for details.
</ul>
</p>

<p>
With transported core dumps, SA may produce an error message or throw
an exception (such as for a missing hotspot symbol) when opening the core dump.
Environment variable <b>LIBSAPROC_DEBUG</b> may be set to any value
to help debug the root casue of these failures. With <b>LIBSAPROC_DEBUG</b> set, SA prints many
messages in standard error which can be useful for further debugging. Note that
<b>LIBSAPROC_DEBUG</b> is not supported on Windows.
</p>

<p>
On  most platforms, core dumps do not contain text (code) pages.
Their pages are instead  read from the executable and shared objects (or DLLs).
Therefore it is important to have a matching java executable and shared object
files on the debugger machine. The best  way to guarantee this match is to match the
debugger machine to that of core dump machine. This means having the same
OS version and libraries, and also having the same version of the JDK. It also means having
the OS libraries and JDK installed in the same locations on both machines. However, often this isn't an option,
and instead you need to include copies of the core dump machine's libraries
and java installation on the debugger machine, and you need
to tell SA where these are all located. That is done differently for each
OS type, and is described in the following sections.
</p>

<h3>Using  transported core dumps on Linux</h3>
<p>
On Linux, SA parses core and shared library ELF files. But, you
may still face problems with transported core dumps, because matching shared
objects may not be in the path(s) specified in core dump file. To
workaround this, you can define environment variable <b>SA_ALTROOT</b>
to be the directory where shared libraries are kept. In this directory you should
copy all the needed JDK libraries. You should also copy any referenced linux
libraries from the core dump machine, unless they are identical to what are
installed on the debugger machine.
</p>
<h3>Using  transported core dumps on Windows</h3>
<p>
 If the debugger machine and core dump machine have identical Windows libraries, then you only
 need to point SA to the location of the JDK bin directory. This is done by making sure
 the bin directory is included in the <b>PATH</b> environment variable. If the windows
 libraries are not identical, then they may also need to be copied to the debugger machine
 and included in <b>PATH</b>.
</p>

<h3>Using  transported core dumps on macOS</h3>
<p>
SA normally uses the path to the specified java executable to locate the JDK libraries. It will look in the following subdirectories for them (relative to the path to the specified java executable):  <b>../lib</b>, <b>../lib/server</b>, <b>../jre/lib</b>, and <b>../jre/lib/server</b>. If not found in any of those locations, it will look in the same subdirectories relative to the <b>JAVA_HOME</b> environment variable, but using <b>JAVA_HOME</b> normally should not be necessary.
</p>

<p>
For locating the macOS libraries, SA uses <b>DYLD_LIBRARY_PATH</b>. If not specified they will be found in their default locations. However, if the core dump machine libraries and the debugger machine's libraries are not the same, then you should copy the core dump  machine libraries to the debugger machine, and point <b>DYLD_LIBRARY_PATH</b> to them.
</p>

<p>
Note: Starting with macOS 12, core files are no longer working with macOS on the x64 platform. See <a href="https://bugs.openjdk.org/browse/JDK-8294316">JDK-8294316</a>.
</p>

</body>
</html>
